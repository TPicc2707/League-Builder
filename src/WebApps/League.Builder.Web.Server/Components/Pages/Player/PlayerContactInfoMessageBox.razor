@using League.Builder.Web.Server.Services.Cache
@inject IPlayerService PlayerService
@inject NavigationManager NavManager;
@inject IPlayerLocalCacheService PlayerLocalCache

<MudDialog>
    <TitleContent>
        <MudText Align="Align.Center" Typo="Typo.h4" Color="Color.Primary" Style="font-weight: bold;">Contact Info</MudText>
    </TitleContent>
    <DialogContent>
        @if (DataLoad)
        {
            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.Center">
                <MudIconButton Href="@MailUrl" Icon="@Icons.Material.Filled.Email" Color="Color.Primary" />
                <MudText Typo="Typo.h6">@PlayerModel.Player.PlayerDetail.EmailAddress</MudText>
            </MudStack>
            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.Center">
                <MudIcon Icon="@Icons.Material.Filled.Phone" Color="Color.Primary" />
                <MudText Typo="Typo.h6">@PlayerModel.Player.PlayerDetail.PhoneNumber</MudText>
            </MudStack>
        }
    </DialogContent>
    <DialogActions>
        <MudButton Color="Color.Primary" OnClick="Ok">Ok</MudButton>
    </DialogActions>
</MudDialog>
@code {
    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; }

    [Parameter]
    public Guid Id { get; set; }
    private bool DataLoad;
    private string MailUrl = string.Empty;

    GetPlayerByIdResponse PlayerModel { get; set; }

    protected override async Task OnInitializedAsync()
    {
        PlayerModel = await PlayerLocalCache.GetPlayerByIdCache(Id.ToString());
        if(PlayerModel == null)
        {
            PlayerModel = await PlayerService.GetPlayerById(Id);
            await PlayerLocalCache.SetPlayerByIdCache(PlayerModel, Id.ToString());
        }
        MailUrl = $"mailto:{PlayerModel.Player.PlayerDetail.EmailAddress}?subject=MessageTitle&amp;body=Message Content";
        DataLoad = true;
    }

    private void Ok() => MudDialog.Cancel();
}
