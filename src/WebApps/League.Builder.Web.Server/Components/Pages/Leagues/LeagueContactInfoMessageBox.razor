@using League.Builder.Web.Server.Services.Cache
@inject ILeagueService LeagueService
@inject ILeagueLocalCacheService LeagueLocalCache
<MudDialog>
    <TitleContent>
        <MudText Align="Align.Center" Typo="Typo.h4" Style="font-weight: bold;">Contact Info</MudText>
    </TitleContent>
    <DialogContent>
        @if (DataLoad)
        {
            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.Center">
                <MudIconButton Href="@MailUrl" Icon="@Icons.Material.Filled.Email" Color="Color.Primary" />
                <MudText Typo="Typo.h6">@League.League.EmailAddress</MudText>
            </MudStack>
        }
    </DialogContent>
    <DialogActions>
        <MudButton Color="Color.Primary" OnClick="Ok">Ok</MudButton>
    </DialogActions>
</MudDialog>
@code {
    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; }

    [Parameter]
    public Guid Id { get; set; }
    private bool DataLoad;
    private string MailUrl = string.Empty;
    GetLeagueByIdResponse League { get; set; }

    protected override async Task OnInitializedAsync()
    {
        League = await LeagueLocalCache.GetLeagueByIdCache(Id.ToString());
        if(League == null)
        {
            League = await LeagueService.GetLeague(Id);
            await LeagueLocalCache.SetLeagueByIdCache(Id.ToString(), League);
        }
        MailUrl = $"mailto:{League.League.EmailAddress}?subject=MessageTitle&amp;body=Message Content";
        DataLoad = true;
    }

    private void Ok() => MudDialog.Cancel();
}
